# AvaTar

MLM на блокчейне. Ближайший пример: https://etherscan.io/address/0xA315bD2e3227C2ab71f1350644B01757EAFf9cb4#code

## Общая схема работы
### Новый пользователь
1. Пользователь получает id реферала через метод `getNextUpliner()`, либо у пользователя уже есть id реферала.
2. Пользователь регистрируется в системе через метод `regUser()`, указывая в параметрах метода id реферала. Также при вызове `regUser()` пользоветель должен отправить 0.05 ETH.

### Существующий пользователь
- У зарегистрированного пользователя есть возможность купить следующий уровень через метод `buyLevel()`, указав в параметре метода желаемый уровень. 
- Если пользователь покупает уровень на 1 меньше, чем его текущий, или на последнем 4м уровне заново покупает уровень 4, то такая операция считается "реинвестом". При реинвесте пользователь покупает уровень, который переносится в следующий цикл.

При вызове метода `buyLevel` также нужно отправить сумму в ETH, соответствующую желаемому уровню.

## API контракта

#### constructor(address payable _rootAddress)
- **_rootAddress** - root/master адрес самого 1го реферала. По умолчанию у root адреса есть все 4 уровня.

Конструктор контракта. Вызывается при миграции в сеть.

#### buyLevel(uint _level) external payable
- **_level** - уровень, который пользователь хочет купить

Метод покупки очередного уровня. При вызове метода пользователь также должен отправить сумму в ETH, соответствующую желаемому уровню.

#### getFreeRef(address payable _refAddress) public view returns (address payable)
- **_refAddress** - адрес реферала, с которого начать поиск
- **RETURN** - адрес реферала со свободными слотами

Метод возвращает адрес реферала со свободными слотами для заданного реферала. Метод может вызвать только зарегистрированный участник.

#### getNextUpliner() external view returns (uint)
- **RETURN** - id реферала со свободными слотами

Метод возвращает id реферала со свободными слотами. Рефералы отсортированы по дате регистрации.

#### getUplinerAddress(uint _level) public view returns(address payable)
- **_level** - желаемый уровень аплайнера
- **RETURN** - адрес вышестоящего аплайнера

Метод возвращает адрес аплайнера нужного уровня для текущего пользователя.

#### isCurrentLevelFull() public view returns (bool)
- **RETURN** - true/false в зависимости от того, заполнен ли у юзера его текущий уровень

Проверяет заполнен ли у пользователя его текущий уровень.

#### isReinvest(uint _level) public view returns (bool)
- **_level** - уровень, который юзер хочет купить
- **RETURN** - true/false в зависимости от того, является ли покупка уровня реинвестом

Проверяет является ли покупка уровня пользователем реинвестом.

#### regUser(uint _refId) external payable
- **_refId** - id реферала

Регистрирует нового пользователя в системе. При вызове метода юзер должен отправить сумму ETH, соответствующую уровню 1.

## Как запустить тесты
```
npm run test
```